
.. DO NOT EDIT.
.. THIS FILE WAS AUTOMATICALLY GENERATED BY SPHINX-GALLERY.
.. TO MAKE CHANGES, EDIT THE SOURCE PYTHON FILE:
.. "auto_examples/5_clustering/plot_5_nco_grid_search.py"
.. LINE NUMBERS ARE GIVEN BELOW.

.. only:: html

    .. note::
        :class: sphx-glr-download-link-note

        :ref:`Go to the end <sphx_glr_download_auto_examples_5_clustering_plot_5_nco_grid_search.py>`
        to download the full example code. or to run this example in your browser via Binder

.. rst-class:: sphx-glr-example-title

.. _sphx_glr_auto_examples_5_clustering_plot_5_nco_grid_search.py:


=============================
NCO - Combinatorial Purged CV
=============================

The previous tutorial introduced the
:class:`~skfolio.optimization.NestedClustersOptimization`.

In this tutorial, we will perform hyperparameter search using `GridSearch` and
distribution analysis with `CombinatorialPurgedCV`.

.. GENERATED FROM PYTHON SOURCE LINES 14-18

Data
====
We load the S&P 500 :ref:`dataset <datasets>` composed of the daily prices of 20
assets from the S&P 500 Index composition starting from 2015-01-02 up to 2022-12-28:

.. GENERATED FROM PYTHON SOURCE LINES 18-45

.. code-block:: Python

    from plotly.io import show
    from sklearn.model_selection import GridSearchCV, train_test_split

    from skfolio import Population, RatioMeasure, RiskMeasure
    from skfolio.cluster import HierarchicalClustering, LinkageMethod
    from skfolio.datasets import load_sp500_dataset
    from skfolio.distance import KendallDistance, PearsonDistance
    from skfolio.model_selection import (
        CombinatorialPurgedCV,
        WalkForward,
        cross_val_predict,
        optimal_folds_number,
    )
    from skfolio.optimization import (
        EqualWeighted,
        MeanRisk,
        NestedClustersOptimization,
        RiskBudgeting,
    )
    from skfolio.preprocessing import prices_to_returns

    prices = load_sp500_dataset()
    prices = prices["2015":]

    X = prices_to_returns(prices)
    X_train, X_test = train_test_split(X, test_size=0.5, shuffle=False)








.. GENERATED FROM PYTHON SOURCE LINES 46-49

Model
=====
We create two models: the NCO and the equal-weighted benchmark:

.. GENERATED FROM PYTHON SOURCE LINES 49-55

.. code-block:: Python

    benchmark = EqualWeighted()

    model_nco = NestedClustersOptimization(
        inner_estimator=MeanRisk(), clustering_estimator=HierarchicalClustering()
    )








.. GENERATED FROM PYTHON SOURCE LINES 56-62

Parameter Tuning
================
We find the model parameters that maximizes the out-of-sample Sharpe ratio using
`GridSearchCV` with `WalkForward` cross-validation on the training set.
The `WalkForward` are chosen to simulate a three months (60 business days) rolling
portfolio fitted on the previous year (252 business days):

.. GENERATED FROM PYTHON SOURCE LINES 62-85

.. code-block:: Python

    cv = WalkForward(train_size=252, test_size=60)

    grid_search_hrp = GridSearchCV(
        estimator=model_nco,
        cv=cv,
        n_jobs=-1,
        param_grid={
            "inner_estimator__risk_measure": [RiskMeasure.VARIANCE, RiskMeasure.CVAR],
            "outer_estimator": [
                EqualWeighted(),
                RiskBudgeting(risk_measure=RiskMeasure.CVAR),
            ],
            "clustering_estimator__linkage_method": [
                LinkageMethod.SINGLE,
                LinkageMethod.WARD,
            ],
            "distance_estimator": [PearsonDistance(), KendallDistance()],
        },
    )
    grid_search_hrp.fit(X_train)
    model_nco = grid_search_hrp.best_estimator_
    print(model_nco)





.. rst-class:: sphx-glr-script-out

 .. code-block:: none

    NestedClustersOptimization(clustering_estimator=HierarchicalClustering(),
                               distance_estimator=PearsonDistance(),
                               inner_estimator=MeanRisk(risk_measure=CVaR),
                               outer_estimator=EqualWeighted())




.. GENERATED FROM PYTHON SOURCE LINES 86-89

Prediction
==========
We evaluate the two models using the same `WalkForward` object on the test set:

.. GENERATED FROM PYTHON SOURCE LINES 89-103

.. code-block:: Python

    pred_bench = cross_val_predict(
        benchmark,
        X_test,
        cv=cv,
        portfolio_params=dict(name="Benchmark"),
    )

    pred_nco = cross_val_predict(
        model_nco,
        X_test,
        cv=cv,
        n_jobs=-1,
        portfolio_params=dict(name="NCO"),
    )







.. GENERATED FROM PYTHON SOURCE LINES 104-106

Each predicted object is a `MultiPeriodPortfolio`.
For improved analysis, we can add them to a `Population`:

.. GENERATED FROM PYTHON SOURCE LINES 106-108

.. code-block:: Python

    population = Population([pred_bench, pred_nco])








.. GENERATED FROM PYTHON SOURCE LINES 109-110

Let's plot the rolling portfolios compositions:

.. GENERATED FROM PYTHON SOURCE LINES 110-112

.. code-block:: Python

    population.plot_composition(display_sub_ptf_name=False)






.. raw:: html

    <div class="output_subarea output_html rendered_html output_result">
    <div>                        <script type="text/javascript">window.PlotlyConfig = {MathJaxConfig: 'local'};</script>
            <script charset="utf-8" src="https://cdn.plot.ly/plotly-2.35.2.min.js"></script>                <div id="0cc01a5a-648b-442c-ba99-f8e0a5161c41" class="plotly-graph-div" style="height:100%; width:100%;"></div>            <script type="text/javascript">                                    window.PLOTLYENV=window.PLOTLYENV || {};                                    if (document.getElementById("0cc01a5a-648b-442c-ba99-f8e0a5161c41")) {                    Plotly.newPlot(                        "0cc01a5a-648b-442c-ba99-f8e0a5161c41",                        [{"alignmentgroup":"True","hovertemplate":"asset=AAPL\u003cbr\u003eindex=%{x}\u003cbr\u003evalue=%{y}\u003cextra\u003e\u003c\u002fextra\u003e","legendgroup":"AAPL","marker":{"color":"#636efa","pattern":{"shape":""}},"name":"AAPL","offsetgroup":"AAPL","orientation":"v","showlegend":true,"textposition":"auto","x":["Benchmark","Benchmark_1","Benchmark_2","Benchmark_3","Benchmark_4","Benchmark_5","Benchmark_6","Benchmark_7","Benchmark_8","Benchmark_9","Benchmark_10","Benchmark_11","NCO","NCO_1","NCO_2","NCO_3","NCO_4","NCO_5","NCO_6","NCO_7","NCO_8","NCO_9","NCO_10","NCO_11"],"xaxis":"x","y":[0.05,0.05,0.05,0.05,0.05,0.05,0.05,0.05,0.05,0.05,0.05,0.05,0.0,0.0,0.0,0.0,0.0194300988227941,0.0,0.0,0.0,0.0,0.0,0.06250602116435977,0.046983003499931286],"yaxis":"y","type":"bar"},{"alignmentgroup":"True","hovertemplate":"asset=AMD\u003cbr\u003eindex=%{x}\u003cbr\u003evalue=%{y}\u003cextra\u003e\u003c\u002fextra\u003e","legendgroup":"AMD","marker":{"color":"#EF553B","pattern":{"shape":""}},"name":"AMD","offsetgroup":"AMD","orientation":"v","showlegend":true,"textposition":"auto","x":["Benchmark","Benchmark_1","Benchmark_2","Benchmark_3","Benchmark_4","Benchmark_5","Benchmark_6","Benchmark_7","Benchmark_8","Benchmark_9","Benchmark_10","Benchmark_11","NCO","NCO_1","NCO_2","NCO_3","NCO_4","NCO_5","NCO_6","NCO_7","NCO_8","NCO_9","NCO_10","NCO_11"],"xaxis":"x","y":[0.05,0.05,0.05,0.05,0.05,0.05,0.05,0.05,0.05,0.05,0.05,0.05,0.0,0.0,0.0,0.14285714285714285,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0],"yaxis":"y","type":"bar"},{"alignmentgroup":"True","hovertemplate":"asset=BAC\u003cbr\u003eindex=%{x}\u003cbr\u003evalue=%{y}\u003cextra\u003e\u003c\u002fextra\u003e","legendgroup":"BAC","marker":{"color":"#00cc96","pattern":{"shape":""}},"name":"BAC","offsetgroup":"BAC","orientation":"v","showlegend":true,"textposition":"auto","x":["Benchmark","Benchmark_1","Benchmark_2","Benchmark_3","Benchmark_4","Benchmark_5","Benchmark_6","Benchmark_7","Benchmark_8","Benchmark_9","Benchmark_10","Benchmark_11","NCO","NCO_1","NCO_2","NCO_3","NCO_4","NCO_5","NCO_6","NCO_7","NCO_8","NCO_9","NCO_10","NCO_11"],"xaxis":"x","y":[0.05,0.05,0.05,0.05,0.05,0.05,0.05,0.05,0.05,0.05,0.05,0.05,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.09281790852213304,0.10121956016824009],"yaxis":"y","type":"bar"},{"alignmentgroup":"True","hovertemplate":"asset=BBY\u003cbr\u003eindex=%{x}\u003cbr\u003evalue=%{y}\u003cextra\u003e\u003c\u002fextra\u003e","legendgroup":"BBY","marker":{"color":"#ab63fa","pattern":{"shape":""}},"name":"BBY","offsetgroup":"BBY","orientation":"v","showlegend":true,"textposition":"auto","x":["Benchmark","Benchmark_1","Benchmark_2","Benchmark_3","Benchmark_4","Benchmark_5","Benchmark_6","Benchmark_7","Benchmark_8","Benchmark_9","Benchmark_10","Benchmark_11","NCO","NCO_1","NCO_2","NCO_3","NCO_4","NCO_5","NCO_6","NCO_7","NCO_8","NCO_9","NCO_10","NCO_11"],"xaxis":"x","y":[0.05,0.05,0.05,0.05,0.05,0.05,0.05,0.05,0.05,0.05,0.05,0.05,0.0,0.0,0.07403193121850998,0.013100145073377228,0.05308398905395486,0.04191011804367237,0.0347305058423166,0.02834676490596389,0.0,0.008372809445787874,0.0,0.0],"yaxis":"y","type":"bar"},{"alignmentgroup":"True","hovertemplate":"asset=CVX\u003cbr\u003eindex=%{x}\u003cbr\u003evalue=%{y}\u003cextra\u003e\u003c\u002fextra\u003e","legendgroup":"CVX","marker":{"color":"#FFA15A","pattern":{"shape":""}},"name":"CVX","offsetgroup":"CVX","orientation":"v","showlegend":true,"textposition":"auto","x":["Benchmark","Benchmark_1","Benchmark_2","Benchmark_3","Benchmark_4","Benchmark_5","Benchmark_6","Benchmark_7","Benchmark_8","Benchmark_9","Benchmark_10","Benchmark_11","NCO","NCO_1","NCO_2","NCO_3","NCO_4","NCO_5","NCO_6","NCO_7","NCO_8","NCO_9","NCO_10","NCO_11"],"xaxis":"x","y":[0.05,0.05,0.05,0.05,0.05,0.05,0.05,0.05,0.05,0.05,0.05,0.05,0.06579607280923831,0.0,0.0,0.0,0.0,0.0,0.08526802405447653,0.08233817309892993,0.012590639350314002,0.20359126452220755,0.20981332492089033,0.1975265975969696],"yaxis":"y","type":"bar"},{"alignmentgroup":"True","hovertemplate":"asset=GE\u003cbr\u003eindex=%{x}\u003cbr\u003evalue=%{y}\u003cextra\u003e\u003c\u002fextra\u003e","legendgroup":"GE","marker":{"color":"#19d3f3","pattern":{"shape":""}},"name":"GE","offsetgroup":"GE","orientation":"v","showlegend":true,"textposition":"auto","x":["Benchmark","Benchmark_1","Benchmark_2","Benchmark_3","Benchmark_4","Benchmark_5","Benchmark_6","Benchmark_7","Benchmark_8","Benchmark_9","Benchmark_10","Benchmark_11","NCO","NCO_1","NCO_2","NCO_3","NCO_4","NCO_5","NCO_6","NCO_7","NCO_8","NCO_9","NCO_10","NCO_11"],"xaxis":"x","y":[0.05,0.05,0.05,0.05,0.05,0.05,0.05,0.05,0.05,0.05,0.05,0.05,0.0,0.0,0.0,0.0,0.0,0.0,0.014657357446401743,0.05231071358074459,0.111459575856417,0.065618183872089,0.037708195519766195,0.01282718846305418],"yaxis":"y","type":"bar"},{"alignmentgroup":"True","hovertemplate":"asset=HD\u003cbr\u003eindex=%{x}\u003cbr\u003evalue=%{y}\u003cextra\u003e\u003c\u002fextra\u003e","legendgroup":"HD","marker":{"color":"#FF6692","pattern":{"shape":""}},"name":"HD","offsetgroup":"HD","orientation":"v","showlegend":true,"textposition":"auto","x":["Benchmark","Benchmark_1","Benchmark_2","Benchmark_3","Benchmark_4","Benchmark_5","Benchmark_6","Benchmark_7","Benchmark_8","Benchmark_9","Benchmark_10","Benchmark_11","NCO","NCO_1","NCO_2","NCO_3","NCO_4","NCO_5","NCO_6","NCO_7","NCO_8","NCO_9","NCO_10","NCO_11"],"xaxis":"x","y":[0.05,0.05,0.05,0.05,0.05,0.05,0.05,0.05,0.05,0.05,0.05,0.05,0.11655926649835524,0.0,0.0,0.0,0.020226669350878846,0.0,0.0,0.062380679135880676,0.006019615968381346,0.0,0.09419477009688842,0.08758031667894031],"yaxis":"y","type":"bar"},{"alignmentgroup":"True","hovertemplate":"asset=JNJ\u003cbr\u003eindex=%{x}\u003cbr\u003evalue=%{y}\u003cextra\u003e\u003c\u002fextra\u003e","legendgroup":"JNJ","marker":{"color":"#B6E880","pattern":{"shape":""}},"name":"JNJ","offsetgroup":"JNJ","orientation":"v","showlegend":true,"textposition":"auto","x":["Benchmark","Benchmark_1","Benchmark_2","Benchmark_3","Benchmark_4","Benchmark_5","Benchmark_6","Benchmark_7","Benchmark_8","Benchmark_9","Benchmark_10","Benchmark_11","NCO","NCO_1","NCO_2","NCO_3","NCO_4","NCO_5","NCO_6","NCO_7","NCO_8","NCO_9","NCO_10","NCO_11"],"xaxis":"x","y":[0.05,0.05,0.05,0.05,0.05,0.05,0.05,0.05,0.05,0.05,0.05,0.05,0.06383677893180774,0.0,0.0,0.02007048766795567,0.0,0.06452794748712543,0.0,0.0,0.0,0.01891891867200651,0.08293337037593004,0.057290133151748406],"yaxis":"y","type":"bar"},{"alignmentgroup":"True","hovertemplate":"asset=JPM\u003cbr\u003eindex=%{x}\u003cbr\u003evalue=%{y}\u003cextra\u003e\u003c\u002fextra\u003e","legendgroup":"JPM","marker":{"color":"#FF97FF","pattern":{"shape":""}},"name":"JPM","offsetgroup":"JPM","orientation":"v","showlegend":true,"textposition":"auto","x":["Benchmark","Benchmark_1","Benchmark_2","Benchmark_3","Benchmark_4","Benchmark_5","Benchmark_6","Benchmark_7","Benchmark_8","Benchmark_9","Benchmark_10","Benchmark_11","NCO","NCO_1","NCO_2","NCO_3","NCO_4","NCO_5","NCO_6","NCO_7","NCO_8","NCO_9","NCO_10","NCO_11"],"xaxis":"x","y":[0.05,0.05,0.05,0.05,0.05,0.05,0.05,0.05,0.05,0.05,0.05,0.05,0.05608468686385596,0.0,0.07989105997852208,0.04989058733606952,0.08730861740005744,0.13635287794482695,0.4000746028701291,0.36229911156754,0.3759497838364356,0.23079054925457199,0.11947389595810076,0.13595325136870567],"yaxis":"y","type":"bar"},{"alignmentgroup":"True","hovertemplate":"asset=KO\u003cbr\u003eindex=%{x}\u003cbr\u003evalue=%{y}\u003cextra\u003e\u003c\u002fextra\u003e","legendgroup":"KO","marker":{"color":"#FECB52","pattern":{"shape":""}},"name":"KO","offsetgroup":"KO","orientation":"v","showlegend":true,"textposition":"auto","x":["Benchmark","Benchmark_1","Benchmark_2","Benchmark_3","Benchmark_4","Benchmark_5","Benchmark_6","Benchmark_7","Benchmark_8","Benchmark_9","Benchmark_10","Benchmark_11","NCO","NCO_1","NCO_2","NCO_3","NCO_4","NCO_5","NCO_6","NCO_7","NCO_8","NCO_9","NCO_10","NCO_11"],"xaxis":"x","y":[0.05,0.05,0.05,0.05,0.05,0.05,0.05,0.05,0.05,0.05,0.05,0.05,0.018542622041141824,0.02369462752287596,0.03533458242207842,0.04082267405810054,0.025538154544276048,0.0055400191155391305,0.022370370711062924,0.03042191343117917,0.06013703968179835,0.0688567230313753,0.0,0.024610111166001248],"yaxis":"y","type":"bar"},{"alignmentgroup":"True","hovertemplate":"asset=LLY\u003cbr\u003eindex=%{x}\u003cbr\u003evalue=%{y}\u003cextra\u003e\u003c\u002fextra\u003e","legendgroup":"LLY","marker":{"color":"#636efa","pattern":{"shape":""}},"name":"LLY","offsetgroup":"LLY","orientation":"v","showlegend":true,"textposition":"auto","x":["Benchmark","Benchmark_1","Benchmark_2","Benchmark_3","Benchmark_4","Benchmark_5","Benchmark_6","Benchmark_7","Benchmark_8","Benchmark_9","Benchmark_10","Benchmark_11","NCO","NCO_1","NCO_2","NCO_3","NCO_4","NCO_5","NCO_6","NCO_7","NCO_8","NCO_9","NCO_10","NCO_11"],"xaxis":"x","y":[0.05,0.05,0.05,0.05,0.05,0.05,0.05,0.05,0.05,0.05,0.05,0.05,0.0,0.0,0.0,0.019888298192243626,0.0,0.0,0.09745427823016921,0.08846179916838082,0.0028250856497287523,0.0,0.0,0.0],"yaxis":"y","type":"bar"},{"alignmentgroup":"True","hovertemplate":"asset=MRK\u003cbr\u003eindex=%{x}\u003cbr\u003evalue=%{y}\u003cextra\u003e\u003c\u002fextra\u003e","legendgroup":"MRK","marker":{"color":"#EF553B","pattern":{"shape":""}},"name":"MRK","offsetgroup":"MRK","orientation":"v","showlegend":true,"textposition":"auto","x":["Benchmark","Benchmark_1","Benchmark_2","Benchmark_3","Benchmark_4","Benchmark_5","Benchmark_6","Benchmark_7","Benchmark_8","Benchmark_9","Benchmark_10","Benchmark_11","NCO","NCO_1","NCO_2","NCO_3","NCO_4","NCO_5","NCO_6","NCO_7","NCO_8","NCO_9","NCO_10","NCO_11"],"xaxis":"x","y":[0.05,0.05,0.05,0.05,0.05,0.05,0.05,0.05,0.05,0.05,0.05,0.05,0.08264521578242848,0.15606401937033232,0.1092134627141009,0.07212783722489051,0.0816233596249284,0.07518925590177411,0.0,0.01845188672071437,0.0872436960234737,0.10970180752905306,0.07295042252446689,0.06394724022865718],"yaxis":"y","type":"bar"},{"alignmentgroup":"True","hovertemplate":"asset=MSFT\u003cbr\u003eindex=%{x}\u003cbr\u003evalue=%{y}\u003cextra\u003e\u003c\u002fextra\u003e","legendgroup":"MSFT","marker":{"color":"#00cc96","pattern":{"shape":""}},"name":"MSFT","offsetgroup":"MSFT","orientation":"v","showlegend":true,"textposition":"auto","x":["Benchmark","Benchmark_1","Benchmark_2","Benchmark_3","Benchmark_4","Benchmark_5","Benchmark_6","Benchmark_7","Benchmark_8","Benchmark_9","Benchmark_10","Benchmark_11","NCO","NCO_1","NCO_2","NCO_3","NCO_4","NCO_5","NCO_6","NCO_7","NCO_8","NCO_9","NCO_10","NCO_11"],"xaxis":"x","y":[0.05,0.05,0.05,0.05,0.05,0.05,0.05,0.05,0.05,0.05,0.05,0.05,0.08344073335885531,0.3333330816233189,0.0,0.10096826398529317,0.15725923745927145,0.20808988049115484,0.0,0.0,0.08939772185327013,0.05714552515088652,0.09329920430404853,0.11543667756578152],"yaxis":"y","type":"bar"},{"alignmentgroup":"True","hovertemplate":"asset=PEP\u003cbr\u003eindex=%{x}\u003cbr\u003evalue=%{y}\u003cextra\u003e\u003c\u002fextra\u003e","legendgroup":"PEP","marker":{"color":"#ab63fa","pattern":{"shape":""}},"name":"PEP","offsetgroup":"PEP","orientation":"v","showlegend":true,"textposition":"auto","x":["Benchmark","Benchmark_1","Benchmark_2","Benchmark_3","Benchmark_4","Benchmark_5","Benchmark_6","Benchmark_7","Benchmark_8","Benchmark_9","Benchmark_10","Benchmark_11","NCO","NCO_1","NCO_2","NCO_3","NCO_4","NCO_5","NCO_6","NCO_7","NCO_8","NCO_9","NCO_10","NCO_11"],"xaxis":"x","y":[0.05,0.05,0.05,0.05,0.05,0.05,0.05,0.05,0.05,0.05,0.05,0.05,0.06616672834818692,0.0,0.0,0.025291680625955784,0.0,0.0,0.0,0.010722509637566673,0.017736913733285013,0.0658378494834192,0.0,0.0],"yaxis":"y","type":"bar"},{"alignmentgroup":"True","hovertemplate":"asset=PFE\u003cbr\u003eindex=%{x}\u003cbr\u003evalue=%{y}\u003cextra\u003e\u003c\u002fextra\u003e","legendgroup":"PFE","marker":{"color":"#FFA15A","pattern":{"shape":""}},"name":"PFE","offsetgroup":"PFE","orientation":"v","showlegend":true,"textposition":"auto","x":["Benchmark","Benchmark_1","Benchmark_2","Benchmark_3","Benchmark_4","Benchmark_5","Benchmark_6","Benchmark_7","Benchmark_8","Benchmark_9","Benchmark_10","Benchmark_11","NCO","NCO_1","NCO_2","NCO_3","NCO_4","NCO_5","NCO_6","NCO_7","NCO_8","NCO_9","NCO_10","NCO_11"],"xaxis":"x","y":[0.05,0.05,0.05,0.05,0.05,0.05,0.05,0.05,0.05,0.05,0.05,0.05,0.05351800449652783,0.0,0.0,0.030770519772053022,0.0,0.0,0.05881169352937286,0.08170704693250404,0.03754901799145731,0.0863532410276406,0.04124301441490642,0.031797856381532284],"yaxis":"y","type":"bar"},{"alignmentgroup":"True","hovertemplate":"asset=PG\u003cbr\u003eindex=%{x}\u003cbr\u003evalue=%{y}\u003cextra\u003e\u003c\u002fextra\u003e","legendgroup":"PG","marker":{"color":"#19d3f3","pattern":{"shape":""}},"name":"PG","offsetgroup":"PG","orientation":"v","showlegend":true,"textposition":"auto","x":["Benchmark","Benchmark_1","Benchmark_2","Benchmark_3","Benchmark_4","Benchmark_5","Benchmark_6","Benchmark_7","Benchmark_8","Benchmark_9","Benchmark_10","Benchmark_11","NCO","NCO_1","NCO_2","NCO_3","NCO_4","NCO_5","NCO_6","NCO_7","NCO_8","NCO_9","NCO_10","NCO_11"],"xaxis":"x","y":[0.05,0.05,0.05,0.05,0.05,0.05,0.05,0.05,0.05,0.05,0.05,0.05,0.024512260366680978,0.0,0.0,0.07674278817308648,0.0,0.0,0.2086022628685762,0.17950738782026,0.053288534652270576,0.02015425448968347,0.0,0.0],"yaxis":"y","type":"bar"},{"alignmentgroup":"True","hovertemplate":"asset=RRC\u003cbr\u003eindex=%{x}\u003cbr\u003evalue=%{y}\u003cextra\u003e\u003c\u002fextra\u003e","legendgroup":"RRC","marker":{"color":"#FF6692","pattern":{"shape":""}},"name":"RRC","offsetgroup":"RRC","orientation":"v","showlegend":true,"textposition":"auto","x":["Benchmark","Benchmark_1","Benchmark_2","Benchmark_3","Benchmark_4","Benchmark_5","Benchmark_6","Benchmark_7","Benchmark_8","Benchmark_9","Benchmark_10","Benchmark_11","NCO","NCO_1","NCO_2","NCO_3","NCO_4","NCO_5","NCO_6","NCO_7","NCO_8","NCO_9","NCO_10","NCO_11"],"xaxis":"x","y":[0.05,0.05,0.05,0.05,0.05,0.05,0.05,0.05,0.05,0.05,0.05,0.05,0.0,0.3333333333333333,0.3333333333333333,0.14285714285714285,0.25,0.25,0.0,0.0,0.0,0.0,0.0107103852067718,0.0],"yaxis":"y","type":"bar"},{"alignmentgroup":"True","hovertemplate":"asset=UNH\u003cbr\u003eindex=%{x}\u003cbr\u003evalue=%{y}\u003cextra\u003e\u003c\u002fextra\u003e","legendgroup":"UNH","marker":{"color":"#B6E880","pattern":{"shape":""}},"name":"UNH","offsetgroup":"UNH","orientation":"v","showlegend":true,"textposition":"auto","x":["Benchmark","Benchmark_1","Benchmark_2","Benchmark_3","Benchmark_4","Benchmark_5","Benchmark_6","Benchmark_7","Benchmark_8","Benchmark_9","Benchmark_10","Benchmark_11","NCO","NCO_1","NCO_2","NCO_3","NCO_4","NCO_5","NCO_6","NCO_7","NCO_8","NCO_9","NCO_10","NCO_11"],"xaxis":"x","y":[0.05,0.05,0.05,0.05,0.05,0.05,0.05,0.05,0.05,0.05,0.05,0.05,0.2,0.0,0.0,0.028788729150004248,0.0,0.0,0.0,0.0,0.0570260075171956,0.06465886596995006,0.05287318991809352,0.033358034570056996],"yaxis":"y","type":"bar"},{"alignmentgroup":"True","hovertemplate":"asset=WMT\u003cbr\u003eindex=%{x}\u003cbr\u003evalue=%{y}\u003cextra\u003e\u003c\u002fextra\u003e","legendgroup":"WMT","marker":{"color":"#FF97FF","pattern":{"shape":""}},"name":"WMT","offsetgroup":"WMT","orientation":"v","showlegend":true,"textposition":"auto","x":["Benchmark","Benchmark_1","Benchmark_2","Benchmark_3","Benchmark_4","Benchmark_5","Benchmark_6","Benchmark_7","Benchmark_8","Benchmark_9","Benchmark_10","Benchmark_11","NCO","NCO_1","NCO_2","NCO_3","NCO_4","NCO_5","NCO_6","NCO_7","NCO_8","NCO_9","NCO_10","NCO_11"],"xaxis":"x","y":[0.05,0.05,0.05,0.05,0.05,0.05,0.05,0.05,0.05,0.05,0.05,0.05,0.09077838924399025,0.15357468420581147,0.1887852859140409,0.14285714285714285,0.14283848420515846,0.10474277554691232,0.07803088476237112,0.0,0.08877636267236891,0.0,0.0,0.03899661839043469],"yaxis":"y","type":"bar"},{"alignmentgroup":"True","hovertemplate":"asset=XOM\u003cbr\u003eindex=%{x}\u003cbr\u003evalue=%{y}\u003cextra\u003e\u003c\u002fextra\u003e","legendgroup":"XOM","marker":{"color":"#FECB52","pattern":{"shape":""}},"name":"XOM","offsetgroup":"XOM","orientation":"v","showlegend":true,"textposition":"auto","x":["Benchmark","Benchmark_1","Benchmark_2","Benchmark_3","Benchmark_4","Benchmark_5","Benchmark_6","Benchmark_7","Benchmark_8","Benchmark_9","Benchmark_10","Benchmark_11","NCO","NCO_1","NCO_2","NCO_3","NCO_4","NCO_5","NCO_6","NCO_7","NCO_8","NCO_9","NCO_10","NCO_11"],"xaxis":"x","y":[0.05,0.05,0.05,0.05,0.05,0.05,0.05,0.05,0.05,0.05,0.05,0.05,0.07811923659457644,0.0,0.1794103158837013,0.09296655537732383,0.16269137294600305,0.11364712043409193,0.0,0.003051997307544588,0.0,0.0,0.029476289872337826,0.052473401661358235],"yaxis":"y","type":"bar"}],                        {"template":{"data":{"histogram2dcontour":[{"type":"histogram2dcontour","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"choropleth":[{"type":"choropleth","colorbar":{"outlinewidth":0,"ticks":""}}],"histogram2d":[{"type":"histogram2d","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"heatmap":[{"type":"heatmap","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"heatmapgl":[{"type":"heatmapgl","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"contourcarpet":[{"type":"contourcarpet","colorbar":{"outlinewidth":0,"ticks":""}}],"contour":[{"type":"contour","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"surface":[{"type":"surface","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"mesh3d":[{"type":"mesh3d","colorbar":{"outlinewidth":0,"ticks":""}}],"scatter":[{"fillpattern":{"fillmode":"overlay","size":10,"solidity":0.2},"type":"scatter"}],"parcoords":[{"type":"parcoords","line":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatterpolargl":[{"type":"scatterpolargl","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"bar":[{"error_x":{"color":"#2a3f5f"},"error_y":{"color":"#2a3f5f"},"marker":{"line":{"color":"#E5ECF6","width":0.5},"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"bar"}],"scattergeo":[{"type":"scattergeo","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatterpolar":[{"type":"scatterpolar","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"histogram":[{"marker":{"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"histogram"}],"scattergl":[{"type":"scattergl","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatter3d":[{"type":"scatter3d","line":{"colorbar":{"outlinewidth":0,"ticks":""}},"marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scattermapbox":[{"type":"scattermapbox","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatterternary":[{"type":"scatterternary","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scattercarpet":[{"type":"scattercarpet","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"carpet":[{"aaxis":{"endlinecolor":"#2a3f5f","gridcolor":"white","linecolor":"white","minorgridcolor":"white","startlinecolor":"#2a3f5f"},"baxis":{"endlinecolor":"#2a3f5f","gridcolor":"white","linecolor":"white","minorgridcolor":"white","startlinecolor":"#2a3f5f"},"type":"carpet"}],"table":[{"cells":{"fill":{"color":"#EBF0F8"},"line":{"color":"white"}},"header":{"fill":{"color":"#C8D4E3"},"line":{"color":"white"}},"type":"table"}],"barpolar":[{"marker":{"line":{"color":"#E5ECF6","width":0.5},"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"barpolar"}],"pie":[{"automargin":true,"type":"pie"}]},"layout":{"autotypenumbers":"strict","colorway":["#636efa","#EF553B","#00cc96","#ab63fa","#FFA15A","#19d3f3","#FF6692","#B6E880","#FF97FF","#FECB52"],"font":{"color":"#2a3f5f"},"hovermode":"closest","hoverlabel":{"align":"left"},"paper_bgcolor":"white","plot_bgcolor":"#E5ECF6","polar":{"bgcolor":"#E5ECF6","angularaxis":{"gridcolor":"white","linecolor":"white","ticks":""},"radialaxis":{"gridcolor":"white","linecolor":"white","ticks":""}},"ternary":{"bgcolor":"#E5ECF6","aaxis":{"gridcolor":"white","linecolor":"white","ticks":""},"baxis":{"gridcolor":"white","linecolor":"white","ticks":""},"caxis":{"gridcolor":"white","linecolor":"white","ticks":""}},"coloraxis":{"colorbar":{"outlinewidth":0,"ticks":""}},"colorscale":{"sequential":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"sequentialminus":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"diverging":[[0,"#8e0152"],[0.1,"#c51b7d"],[0.2,"#de77ae"],[0.3,"#f1b6da"],[0.4,"#fde0ef"],[0.5,"#f7f7f7"],[0.6,"#e6f5d0"],[0.7,"#b8e186"],[0.8,"#7fbc41"],[0.9,"#4d9221"],[1,"#276419"]]},"xaxis":{"gridcolor":"white","linecolor":"white","ticks":"","title":{"standoff":15},"zerolinecolor":"white","automargin":true,"zerolinewidth":2},"yaxis":{"gridcolor":"white","linecolor":"white","ticks":"","title":{"standoff":15},"zerolinecolor":"white","automargin":true,"zerolinewidth":2},"scene":{"xaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white","gridwidth":2},"yaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white","gridwidth":2},"zaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white","gridwidth":2}},"shapedefaults":{"line":{"color":"#2a3f5f"}},"annotationdefaults":{"arrowcolor":"#2a3f5f","arrowhead":0,"arrowwidth":1},"geo":{"bgcolor":"white","landcolor":"#E5ECF6","subunitcolor":"white","showland":true,"showlakes":true,"lakecolor":"white"},"title":{"x":0.05},"mapbox":{"style":"light"}}},"xaxis":{"anchor":"y","domain":[0.0,1.0],"title":{"text":"Portfolios"}},"yaxis":{"anchor":"x","domain":[0.0,1.0],"title":{"text":"Weight"},"tickformat":",.0%"},"legend":{"title":{"text":"asset"},"tracegroupgap":0,"yanchor":"top","y":0.99,"xanchor":"left","x":1.15},"margin":{"t":60},"barmode":"relative","title":{"text":"Portfolios Composition"}},                        {"responsive": true}                    )                };                            </script>        </div>
    </div>
    <br />
    <br />

.. GENERATED FROM PYTHON SOURCE LINES 113-114

Let's plot the rolling portfolios cumulative returns on the test set:

.. GENERATED FROM PYTHON SOURCE LINES 114-117

.. code-block:: Python

    fig = population.plot_cumulative_returns()
    show(fig)




.. raw:: html
    :file: images/sphx_glr_plot_5_nco_grid_search_001.html





.. GENERATED FROM PYTHON SOURCE LINES 118-122

Analysis
========
The NCO outperforms the Benchmark on the test set for the below measures:
maximization:

.. GENERATED FROM PYTHON SOURCE LINES 122-130

.. code-block:: Python

    for ptf in population:
        print("=" * 25)
        print(" " * 8 + ptf.name)
        print("=" * 25)
        print(f"Ann. Sharpe ratio : {ptf.annualized_sharpe_ratio:0.2f}")
        print(f"CVaR ratio : {ptf.cvar_ratio:0.4f}")
        print("\n")





.. rst-class:: sphx-glr-script-out

 .. code-block:: none

    =========================
            Benchmark
    =========================
    Ann. Sharpe ratio : 0.88
    CVaR ratio : 0.0235


    =========================
            NCO
    =========================
    Ann. Sharpe ratio : 1.30
    CVaR ratio : 0.0376






.. GENERATED FROM PYTHON SOURCE LINES 131-140

Combinatorial Purged Cross-Validation
=====================================
Only using one testing path (the historical path) may not be enough for comparing both
models. For a more robust analysis, we can use
:class:`~skfolio.model_selection.CombinatorialPurgedCV` to create multiple testing
paths from different training folds combinations.

We choose `n_folds` and `n_test_folds` to obtain around 30 test paths and an average
training size of 252 days:

.. GENERATED FROM PYTHON SOURCE LINES 140-149

.. code-block:: Python

    n_folds, n_test_folds = optimal_folds_number(
        n_observations=X_test.shape[0],
        target_n_test_paths=30,
        target_train_size=252,
    )

    cv = CombinatorialPurgedCV(n_folds=n_folds, n_test_folds=n_test_folds)
    cv.summary(X_test)





.. rst-class:: sphx-glr-script-out

 .. code-block:: none


    Number of Observations             1006
    Total Number of Folds                 9
    Number of Test Folds                  7
    Purge Size                            0
    Embargo Size                          0
    Average Training Size               223
    Number of Test Paths                 28
    Number of Training Combinations      36
    dtype: int64



.. GENERATED FROM PYTHON SOURCE LINES 150-158

.. code-block:: Python

    pred_nco = cross_val_predict(
        model_nco,
        X_test,
        cv=cv,
        n_jobs=-1,
        portfolio_params=dict(tag="NCO"),
    )








.. GENERATED FROM PYTHON SOURCE LINES 159-161

The predicted object is a `Population` of `MultiPeriodPortfolio`. Each
`MultiPeriodPortfolio` represents one testing path of a rolling portfolio.

.. GENERATED FROM PYTHON SOURCE LINES 163-166

Distribution
============
We plot the out-of-sample distribution of Sharpe Ratio for the NCO model:

.. GENERATED FROM PYTHON SOURCE LINES 166-168

.. code-block:: Python

    pred_nco.plot_distribution(measure_list=[RatioMeasure.ANNUALIZED_SHARPE_RATIO])






.. raw:: html

    <div class="output_subarea output_html rendered_html output_result">
    <div>                        <script type="text/javascript">window.PlotlyConfig = {MathJaxConfig: 'local'};</script>
            <script charset="utf-8" src="https://cdn.plot.ly/plotly-2.35.2.min.js"></script>                <div id="6f247cc1-0ade-4aed-835b-928bdcce72ae" class="plotly-graph-div" style="height:100%; width:100%;"></div>            <script type="text/javascript">                                    window.PLOTLYENV=window.PLOTLYENV || {};                                    if (document.getElementById("6f247cc1-0ade-4aed-835b-928bdcce72ae")) {                    Plotly.newPlot(                        "6f247cc1-0ade-4aed-835b-928bdcce72ae",                        [{"alignmentgroup":"True","bingroup":"x","hovertemplate":"Population=annualized_sharpe_ratio\u003cbr\u003e_value=%{x}\u003cbr\u003ecount=%{y}\u003cextra\u003e\u003c\u002fextra\u003e","legendgroup":"annualized_sharpe_ratio","marker":{"color":"#636efa","opacity":0.5,"pattern":{"shape":""}},"name":"annualized_sharpe_ratio","offsetgroup":"annualized_sharpe_ratio","orientation":"v","showlegend":true,"x":[0.9369893401174825,0.8289544115181526,0.8023906937767936,0.9570353066578016,1.0244266114307508,0.8324333228920608,0.8290630205547496,0.8696312032516874,0.7685045975102623,0.7962655410170795,1.1141885710478394,1.0844644258908824,1.1986581901762845,1.1423356634231607,0.8984830768058558,0.5939892488648074,0.5306966896700316,0.6726272080772182,0.522907926992296,0.6433831947093013,1.1203049304591441,0.9003103339000779,0.7138475844964376,0.8057974084788642,0.9455802594747788,0.80800460147351,1.0755876468268364,0.6472745130777607],"xaxis":"x","yaxis":"y","type":"histogram"},{"alignmentgroup":"True","hovertemplate":"Population=annualized_sharpe_ratio\u003cbr\u003e_value=%{x}\u003cextra\u003e\u003c\u002fextra\u003e","legendgroup":"annualized_sharpe_ratio","marker":{"color":"#636efa"},"name":"annualized_sharpe_ratio","notched":true,"offsetgroup":"annualized_sharpe_ratio","showlegend":false,"x":[0.9369893401174825,0.8289544115181526,0.8023906937767936,0.9570353066578016,1.0244266114307508,0.8324333228920608,0.8290630205547496,0.8696312032516874,0.7685045975102623,0.7962655410170795,1.1141885710478394,1.0844644258908824,1.1986581901762845,1.1423356634231607,0.8984830768058558,0.5939892488648074,0.5306966896700316,0.6726272080772182,0.522907926992296,0.6433831947093013,1.1203049304591441,0.9003103339000779,0.7138475844964376,0.8057974084788642,0.9455802594747788,0.80800460147351,1.0755876468268364,0.6472745130777607],"xaxis":"x2","yaxis":"y2","type":"box"}],                        {"template":{"data":{"histogram2dcontour":[{"type":"histogram2dcontour","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"choropleth":[{"type":"choropleth","colorbar":{"outlinewidth":0,"ticks":""}}],"histogram2d":[{"type":"histogram2d","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"heatmap":[{"type":"heatmap","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"heatmapgl":[{"type":"heatmapgl","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"contourcarpet":[{"type":"contourcarpet","colorbar":{"outlinewidth":0,"ticks":""}}],"contour":[{"type":"contour","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"surface":[{"type":"surface","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"mesh3d":[{"type":"mesh3d","colorbar":{"outlinewidth":0,"ticks":""}}],"scatter":[{"fillpattern":{"fillmode":"overlay","size":10,"solidity":0.2},"type":"scatter"}],"parcoords":[{"type":"parcoords","line":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatterpolargl":[{"type":"scatterpolargl","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"bar":[{"error_x":{"color":"#2a3f5f"},"error_y":{"color":"#2a3f5f"},"marker":{"line":{"color":"#E5ECF6","width":0.5},"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"bar"}],"scattergeo":[{"type":"scattergeo","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatterpolar":[{"type":"scatterpolar","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"histogram":[{"marker":{"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"histogram"}],"scattergl":[{"type":"scattergl","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatter3d":[{"type":"scatter3d","line":{"colorbar":{"outlinewidth":0,"ticks":""}},"marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scattermapbox":[{"type":"scattermapbox","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatterternary":[{"type":"scatterternary","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scattercarpet":[{"type":"scattercarpet","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"carpet":[{"aaxis":{"endlinecolor":"#2a3f5f","gridcolor":"white","linecolor":"white","minorgridcolor":"white","startlinecolor":"#2a3f5f"},"baxis":{"endlinecolor":"#2a3f5f","gridcolor":"white","linecolor":"white","minorgridcolor":"white","startlinecolor":"#2a3f5f"},"type":"carpet"}],"table":[{"cells":{"fill":{"color":"#EBF0F8"},"line":{"color":"white"}},"header":{"fill":{"color":"#C8D4E3"},"line":{"color":"white"}},"type":"table"}],"barpolar":[{"marker":{"line":{"color":"#E5ECF6","width":0.5},"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"barpolar"}],"pie":[{"automargin":true,"type":"pie"}]},"layout":{"autotypenumbers":"strict","colorway":["#636efa","#EF553B","#00cc96","#ab63fa","#FFA15A","#19d3f3","#FF6692","#B6E880","#FF97FF","#FECB52"],"font":{"color":"#2a3f5f"},"hovermode":"closest","hoverlabel":{"align":"left"},"paper_bgcolor":"white","plot_bgcolor":"#E5ECF6","polar":{"bgcolor":"#E5ECF6","angularaxis":{"gridcolor":"white","linecolor":"white","ticks":""},"radialaxis":{"gridcolor":"white","linecolor":"white","ticks":""}},"ternary":{"bgcolor":"#E5ECF6","aaxis":{"gridcolor":"white","linecolor":"white","ticks":""},"baxis":{"gridcolor":"white","linecolor":"white","ticks":""},"caxis":{"gridcolor":"white","linecolor":"white","ticks":""}},"coloraxis":{"colorbar":{"outlinewidth":0,"ticks":""}},"colorscale":{"sequential":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"sequentialminus":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"diverging":[[0,"#8e0152"],[0.1,"#c51b7d"],[0.2,"#de77ae"],[0.3,"#f1b6da"],[0.4,"#fde0ef"],[0.5,"#f7f7f7"],[0.6,"#e6f5d0"],[0.7,"#b8e186"],[0.8,"#7fbc41"],[0.9,"#4d9221"],[1,"#276419"]]},"xaxis":{"gridcolor":"white","linecolor":"white","ticks":"","title":{"standoff":15},"zerolinecolor":"white","automargin":true,"zerolinewidth":2},"yaxis":{"gridcolor":"white","linecolor":"white","ticks":"","title":{"standoff":15},"zerolinecolor":"white","automargin":true,"zerolinewidth":2},"scene":{"xaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white","gridwidth":2},"yaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white","gridwidth":2},"zaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white","gridwidth":2}},"shapedefaults":{"line":{"color":"#2a3f5f"}},"annotationdefaults":{"arrowcolor":"#2a3f5f","arrowhead":0,"arrowwidth":1},"geo":{"bgcolor":"white","landcolor":"#E5ECF6","subunitcolor":"white","showland":true,"showlakes":true,"lakecolor":"white"},"title":{"x":0.05},"mapbox":{"style":"light"}}},"xaxis":{"anchor":"y","domain":[0.0,1.0],"title":{"text":"measures"}},"yaxis":{"anchor":"x","domain":[0.0,0.7326],"title":{"text":"count"}},"xaxis2":{"anchor":"y2","domain":[0.0,1.0],"matches":"x","showticklabels":false,"showgrid":true},"yaxis2":{"anchor":"x2","domain":[0.7426,1.0],"matches":"y2","showticklabels":false,"showline":false,"ticks":"","showgrid":false},"legend":{"title":{"text":"Population"},"tracegroupgap":0},"margin":{"t":60},"barmode":"overlay","title":{"text":"Measures Distribution"}},                        {"responsive": true}                    )                };                            </script>        </div>
    </div>
    <br />
    <br />

.. GENERATED FROM PYTHON SOURCE LINES 169-170

Let's print the average and standard-deviation of out-of-sample Sharpe Ratios:

.. GENERATED FROM PYTHON SOURCE LINES 170-179

.. code-block:: Python

    print(
        "Average of Sharpe Ratio :"
        f" {pred_nco.measures_mean(measure=RatioMeasure.ANNUALIZED_SHARPE_RATIO):0.2f}"
    )
    print(
        "Std of Sharpe Ratio :"
        f" {pred_nco.measures_std(measure=RatioMeasure.ANNUALIZED_SHARPE_RATIO):0.2f}"
    )





.. rst-class:: sphx-glr-script-out

 .. code-block:: none

    Average of Sharpe Ratio : 0.86
    Std of Sharpe Ratio : 0.18




.. GENERATED FROM PYTHON SOURCE LINES 180-181

Let's compare it with the benchmark:

.. GENERATED FROM PYTHON SOURCE LINES 181-184

.. code-block:: Python

    pred_bench = benchmark.fit_predict(X_test)
    print(pred_bench.annualized_sharpe_ratio)





.. rst-class:: sphx-glr-script-out

 .. code-block:: none

    1.0507476631082548




.. GENERATED FROM PYTHON SOURCE LINES 185-195

Conclusion
==========
This NCO model outperforms the Benchmark in terms of Sharpe Ratio on the historical
test set. However, the distribution analysis on the recombined (non-historical) test
sets shows that it slightly underperforms the Benchmark in average.

This was a toy example to present the API. Further analysis using different
estimators, datasets and CV parameters should be performed to determine if the
outperformance on the historical test set is due to chance or if this NCO model is
able to exploit time-dependencies information lost in `CombinatorialPurgedCV`.


.. rst-class:: sphx-glr-timing

   **Total running time of the script:** (0 minutes 32.485 seconds)


.. _sphx_glr_download_auto_examples_5_clustering_plot_5_nco_grid_search.py:

.. only:: html

  .. container:: sphx-glr-footer sphx-glr-footer-example

    .. container:: binder-badge

      .. image:: images/binder_badge_logo.svg
        :target: https://mybinder.org/v2/gh/skfolio/skfolio/gh-pages?urlpath=lab/tree/notebooks/auto_examples/5_clustering/plot_5_nco_grid_search.ipynb
        :alt: Launch binder
        :width: 150 px

    .. container:: sphx-glr-download sphx-glr-download-jupyter

      :download:`Download Jupyter notebook: plot_5_nco_grid_search.ipynb <plot_5_nco_grid_search.ipynb>`

    .. container:: sphx-glr-download sphx-glr-download-python

      :download:`Download Python source code: plot_5_nco_grid_search.py <plot_5_nco_grid_search.py>`

    .. container:: sphx-glr-download sphx-glr-download-zip

      :download:`Download zipped: plot_5_nco_grid_search.zip <plot_5_nco_grid_search.zip>`


.. only:: html

 .. rst-class:: sphx-glr-signature

    `Gallery generated by Sphinx-Gallery <https://sphinx-gallery.github.io>`_
